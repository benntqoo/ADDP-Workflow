version: '3.8'

services:
  ai-launcher-build:
    build:
      context: .
      dockerfile: build/docker/Dockerfile
    image: ai-launcher:latest
    container_name: ai-launcher-gui

    # GUIåº”ç”¨éœ€è¦X11è½¬å‘ (Linuxç¯å¢ƒ)
    environment:
      - DISPLAY=${DISPLAY:-:0}
      - QT_QPA_PLATFORM=minimal

    # æŒ‚è½½X11å¥—æ¥å­?(Linuxç¯å¢ƒä¸‹å¯ç”?
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ~/.Xauthority:/home/appuser/.Xauthority:ro

    # ç½‘ç»œæ¨¡å¼
    network_mode: host

    # æƒé™è®¾ç½®
    privileged: false

    # é‡å¯ç­–ç•¥
    restart: unless-stopped

    # æ—¥å¿—é…ç½®
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # å¼€å‘æ¨¡å¼æœåŠ?(ä»…æ„å»ºï¼Œä¸è¿è¡?
  ai-launcher-dev:
    build:
      context: .
      dockerfile: build/docker/Dockerfile
      target: builder
    image: ai-launcher:dev
    container_name: ai-launcher-dev
    volumes:
      - .:/app
      - go-cache:/go/pkg/mod
    working_dir: /app
    command: /bin/sh
    stdin_open: true
    tty: true

volumes:
  go-cache:
