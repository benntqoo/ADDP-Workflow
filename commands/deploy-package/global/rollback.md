---
arguments: optional
format: "[code|db|config|all|emergency]"
examples:
  - "/rollback code - 生成代码回滚方案"
  - "/rollback db - 生成数据库回滚方案"
  - "/rollback config - 生成配置回滚方案"
  - "/rollback all - 生成全面回滚方案"
  - "/rollback emergency - 生成紧急回滚预案"
---
回滚方案生成器：

## 🔄 回滚类型分析

### 1. 代码回滚
```bash
# Git 回滚策略
- 回滚到上一个稳定版本
- 回滚特定提交
- 回滚合并请求
- 热修复分支策略
```

### 2. 数据库回滚
```sql
-- 数据库回滚要点
- 结构回滚（DDL）
- 数据回滚（DML）
- 事务日志恢复
- 备份还原策略
```

### 3. 配置回滚
```yaml
配置管理:
  - 环境变量还原
  - 配置文件版本控制
  - 特性开关关闭
  - 服务降级配置
```

## 📋 回滚方案模板

### 快速回滚（< 5分钟）
1. **代码层面**
   ```bash
   git revert [commit-hash]
   git push --force-with-lease
   ```

2. **部署层面**
   - 切换到上一个部署版本
   - 蓝绿部署切换
   - 金丝雀部署回退

### 标准回滚（5-30分钟）
1. **准备阶段**
   - 通知相关人员
   - 准备回滚脚本
   - 验证备份可用性

2. **执行阶段**
   - 停止新流量
   - 执行回滚操作
   - 验证系统状态

3. **验证阶段**
   - 功能验证
   - 数据一致性检查
   - 监控指标确认

### 紧急回滚（灾难恢复）
1. **立即行动**
   - 启用维护模式
   - 切换到灾备环境
   - 执行紧急修复

2. **数据恢复**
   - 从备份恢复
   - 修复数据不一致
   - 补偿事务处理

## 🛡️ 预防措施

### 回滚演练
- 定期测试回滚流程
- 记录回滚时间
- 优化回滚步骤
- 更新应急预案

### 自动化支持
```yaml
自动回滚触发条件:
  - 错误率 > 10%
  - 响应时间 > 5s
  - 内存使用 > 90%
  - 健康检查失败
```

## 📄 文档输出

生成以下文档：
1. 回滚操作手册 → `docs/guides/rollback-guide.md`
2. 回滚脚本 → `scripts/rollback/`
3. 检查清单 → `docs/guides/rollback-checklist.md`
4. 联系人列表 → `docs/internal/emergency-contacts.md`

## ⚠️ 风险提醒

- 数据丢失风险评估
- 用户影响范围
- 服务中断时长
- 级联故障可能性