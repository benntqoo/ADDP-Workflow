---
arguments: required
format: "[任務描述]"
examples:
  - "/plan 實現用戶登錄功能"
  - "/plan 修復訂單計算錯誤"
  - "/plan 優化首頁加載速度"
---

# 任務規劃與設計

我將幫你把需求轉化為可執行的開發計劃，並開始一個新的開發週期：

## 🔄 週期管理

<!-- File Operations: Direct Write -->
<!-- Target: .claude/memory/last-session.yml -->

### 自動執行
當你使用 /plan 時，我會：
1. 標記新開發週期的開始
2. 直接保存會話狀態到 `.claude/memory/last-session.yml`
3. 記錄計劃內容和開始時間
4. 清理上個週期的遺留任務
5. 設置工作狀態為 "planning"

## 📋 規劃流程

### 1. 需求分析
- 理解你要實現什麼
- 分析為什麼需要這個功能
- 確認預期的效果
- 識別約束條件

### 2. 影響評估
- 需要修改哪些文件
- 會影響哪些現有功能
- 是否需要數據庫變更
- API 是否需要調整

### 3. 技術方案
```markdown
## 實施方案

### 技術選型
- [選擇的技術和理由]

### 架構設計
- [組件結構]
- [數據流向]
- [接口設計]

### 實施步驟
1. [步驟1：具體任務]
2. [步驟2：具體任務]
3. [步驟3：具體任務]
...
```

### 4. 風險識別
- 技術風險及應對
- 時間風險評估
- 依賴風險分析
- 回滾計劃

### 5. 任務清單
生成可追蹤的任務列表：
- [ ] 準備工作
- [ ] 核心實現
- [ ] 測試編寫
- [ ] 文檔更新
- [ ] 代碼審查

### 6. 資源準備
- 需要的文檔/資料
- 依賴的工具/庫
- 參考的代碼示例
- 相關的最佳實踐

### 7. 保存會話狀態

直接更新會話狀態文件：

```bash
# 確保目錄存在
mkdir -p .claude/memory
```

然後寫入 `.claude/memory/last-session.yml`：

```yaml
# 會話狀態結構
session:
  cycle:
    id: "[date]-[topic]"
    type: "feature|bugfix|refactor"
    description: "本次規劃的任務"
    started_at: "當前時間"
  workflow_state: "planning"
  current_task:
    description: "任務描述"
    plan_reference: ".claude/plans/[date]-[topic].md"
  pending_todos: [生成的任務列表]
  next_cycle:
    status: "planning"
```

**文件操作流程**：
1. 讀取現有文件（如存在）
2. 更新會話信息
3. 保持 YAML 格式
4. 寫回文件

## 🎯 輸出格式

```markdown
# 任務：[任務名稱]

## 📍 理解確認
我理解你需要：[簡述]

## 🎯 實施計劃
[詳細的分步計劃]

## ⚠️ 注意事項
[需要特別注意的點]

## ✅ 檢查清單
[可追蹤的任務列表]

## 🚀 建議開始
[第一步應該做什麼]
```

## 💡 最佳實踐

1. **任務描述要具體**：說明要做什麼，為什麼做
2. **提供背景信息**：相關的業務邏輯或技術限制
3. **明確成功標準**：怎樣算是完成了任務

## 🔄 與其他命令的連動

### 工作流程
```
/plan（開始新週期）
    ↓ 創建/更新 last-session.yml
/context（確認理解）
    ↓ 讀取當前計劃
[開發工作]
    ↓
/learn（記錄決策）
    ↓ 增量更新
/update-spec（週期終結）
    ↓ 完整保存狀態
```

### 狀態連續性
- /plan 開始的週期會被 /update-spec 終結
- 中間的所有工作都會被追踪
- /sync 可以恢復到任何中斷點

這個規劃將成為我們後續開發的路線圖，並自動管理開發週期！