---
arguments: required
format: "[功能/模組] [具體疑慮或'deep']"
examples:
  - "/analyze 用戶認證 併發登錄時的 token 處理"
  - "/analyze 緩存系統 deep"  # 全面深度分析
  - "/analyze API 限流 極端流量場景"
  - "/analyze 支付流程 異常中斷的資金安全"
---

# 深度分析與驗證專家

我將幫你進行深度的技術分析，驗證你的直覺和疑慮，找出潛在問題：

## 🎯 分析維度

### 1. 邊界條件分析
- **極限值測試**：最大值、最小值、空值、邊界值
- **併發場景**：競態條件、死鎖、資源爭搶
- **異常流程**：網絡中斷、超時、部分失敗
- **資源限制**：內存不足、磁盤滿、連接池耗盡

### 2. 特殊場景推演
- **用戶行為異常**：
  - 重複點擊
  - 快速切換
  - 非預期操作順序
  - 惡意輸入
- **系統狀態異常**：
  - 服務降級
  - 部分組件失效
  - 時鐘偏移
  - 數據不一致

### 3. 架構層面審視
- **擴展性問題**：當數據量增長 10x、100x 時
- **維護性問題**：未來需求變更的影響
- **安全性問題**：潛在的攻擊向量
- **性能瓶頸**：隱藏的 N+1、慢查詢、內存洩漏

### 4. 業務邏輯驗證
- **狀態機完整性**：所有狀態轉換是否合理
- **數據一致性**：事務邊界是否正確
- **業務規則衝突**：不同規則之間的矛盾
- **合規性要求**：法規、審計、隱私要求

## 📝 分析流程

### 階段 1：問題識別
```
1. 理解你的疑慮（明確的或模糊的直覺）
2. 定位相關代碼和邏輯
3. 識別關鍵假設和依賴
```

### 階段 2：場景構建
```
1. 列舉所有可能的邊界情況
2. 構建異常場景矩陣
3. 模擬極端用戶行為
4. 考慮系統故障模式
```

### 階段 3：深度推演
```
1. 逐個場景進行邏輯推演
2. 分析數據流和狀態變化
3. 檢查錯誤處理路徑
4. 評估恢復機制
```

### 階段 4：風險評估
```
1. 問題發生概率：高/中/低
2. 影響嚴重程度：致命/嚴重/一般/輕微
3. 檢測難易度：容易/困難
4. 修復成本：高/中/低
```

## 💡 輸出內容

### 1. 問題清單
```markdown
## 🚨 發現的潛在問題

### 高風險
1. **問題**：[具體描述]
   - **場景**：[觸發條件]
   - **影響**：[後果]
   - **建議**：[解決方案]

### 中風險
...

### 低風險
...
```

### 2. 測試建議
```markdown
## 🧪 建議的測試場景

1. **邊界測試**：
   - [ ] 測試用例 1
   - [ ] 測試用例 2

2. **壓力測試**：
   - [ ] 併發場景
   - [ ] 資源耗盡

3. **異常測試**：
   - [ ] 故障注入
   - [ ] 混沌工程
```

### 3. 改進建議
```markdown
## 🔧 架構改進建議

1. **短期優化**：（1-2 天）
   - 具體改進點

2. **中期重構**：（1-2 週）
   - 結構調整建議

3. **長期演進**：（1-2 月）
   - 架構升級方向
```

## 🎯 典型使用場景

### 場景 1：明確的疑慮
```bash
/analyze "緩存系統" "高併發下的緩存擊穿問題"
```
我會：
- 分析現有緩存策略
- 模擬擊穿場景
- 提供具體的防護方案

### 場景 2：模糊的直覺
```bash
/analyze "支付模組" "deep"
```
我會：
- 全面審查支付流程
- 分析所有異常路徑
- 檢查資金安全性
- 評估合規性

### 場景 3：性能擔憂
```bash
/analyze "查詢接口" "數據量增長後的性能"
```
我會：
- 分析查詢複雜度
- 評估索引使用
- 預測性能瓶頸
- 提供優化方案

## 🔄 與其他命令的協作

```
/analyze "功能X" "疑慮Y"     # 深度分析
         ↓
    發現潛在問題
         ↓
/plan "修復問題"             # 規劃解決方案
         ↓
/test "邊界場景"             # 生成測試用例
         ↓
/learn "記錄經驗"            # 沉澱知識
```

## 💡 分析原則

1. **假設最壞情況**：墨菲定律永遠適用
2. **關注狀態轉換**：大部分 bug 在邊界
3. **考慮時間因素**：併發、超時、順序
4. **重視錯誤處理**：異常路徑往往被忽視
5. **量化風險等級**：幫助優先級決策

## 🎯 預期效果

使用此命令後，你將獲得：
1. **潛在問題的完整清單**（按風險分級）
2. **具體的測試場景建議**（可直接執行）
3. **改進方案的優先級排序**（短中長期）
4. **決策依據的量化分析**（數據支撐）

準備好深入分析你的疑慮了嗎？相信你的直覺，讓我們一起驗證！