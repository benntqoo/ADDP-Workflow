---
arguments: optional
format: "[on|off|status|report]"
examples:
  - "/watch on - 開啟監察模式"
  - "/watch off - 關閉監察模式"
  - "/watch status - 查看當前狀態"
  - "/watch report - 生成質量報告"
---

# 監察模式 - 協作式質量守護

## ⚠️ 重要說明
**此命令並非真正的實時監控**。由於 Claude Code 的架構限制，無法在背景持續運行或主動監控文件變化。這是一個**協作式的工作模式**，需要您主動提交代碼片段來觸發檢查。

## 🎯 實際工作方式

與 `/check` 共享檢查引擎，但工作模式不同：
- `/check`：完整質量檢查（手動觸發，完整報告）
- `/watch`：監察模式（持續關注，即時反饋）

### 工作原理
```yaml
實際運作:
  1. 開啟監察模式 (/watch on)
  2. 您提交代碼片段或描述變更
  3. Claude 自動執行檢查並即時反饋
  4. 追踪問題狀態直到修復
  
限制說明:
  - 需要主動提交代碼才能檢查
  - 無法監控文件系統變化
  - 無法在背景運行
  - 依賴對話交互
```

## 🛡️ 核心功能

### 監察模式開關
```bash
/watch on    # 開啟 - 進入監察模式
/watch off   # 關閉 - 退出監察模式
```

當監察模式開啟時，Claude 會：
- 對您提交的每段代碼自動檢查
- 優先報告嚴重問題
- 記住已發現的問題
- 追踪修復進度

### 監控內容（需主動提交）
使用與 `/check` 相同的檢查引擎：

1. **🔴 安全問題**（立即提醒）
   - 硬編碼密鑰和敏感信息
   - SQL 注入風險
   - XSS/CSRF 漏洞
   - 不安全的依賴

2. **🟡 代碼質量**（累積提醒）
   - 複雜度過高（>10）
   - 重複代碼
   - 未使用的變量
   - 缺失的錯誤處理

3. **⚡ 性能風險**（關鍵提醒）
   - N+1 查詢
   - 內存洩漏風險
   - 阻塞操作
   - 大文件導入

4. **✅ 最佳實踐**（定期提醒）
   - 測試覆蓋不足
   - 缺失文檔
   - 違反 SOLID 原則
   - 缺少類型定義

## 📋 使用方式

### 推薦工作流程
```bash
# 1. 開啟監察
/watch on
> 監察模式已開啟，請在編碼時定期提交代碼片段

# 2. 編碼並主動提交
"我剛寫了用戶驗證函數：[貼上代碼]"
> 🔴 發現安全問題：密碼未加密存儲
> 💡 建議使用 bcrypt 加密

# 3. 修復後再次提交
"已修復，現在使用 bcrypt：[貼上修復後代碼]"
> ✅ 安全問題已解決
> ⚠️ 建議：添加密碼強度檢查

# 4. 查看狀態
/watch status
> 監察時長：45分鐘
> 發現問題：3個（已修復2個）

# 5. 結束監察
/watch off
```

### 智能提醒機制
```yaml
提醒策略:
  新問題: 立即提醒
  已知問題: 不重複提醒
  修復確認: 提示已解決
  
優先級:
  🔴 高危: 立即中斷提醒
  🟡 中等: 批量提醒
  🔵 建議: 階段性總結
```

## 📊 狀態與報告

### 查看狀態
```bash
/watch status
```
顯示：
- 監察模式：開啟/關閉
- 監察時長：記錄本次會話時長
- 發現問題：分類統計
- 修復進度：已解決/待解決

### 生成報告
```bash
/watch report
```
輸出本次監察期間的：
- 問題統計分析
- 修復效率
- 重點關注區域
- 改進建議

## 💡 最佳實踐

### 如何有效使用監察模式

1. **小步提交**
   - 寫完一個函數就提交檢查
   - 不要等到大量代碼後才提交

2. **明確描述**
   - "我添加了用戶認證功能"
   - "修改了數據庫查詢邏輯"

3. **及時修復**
   - 收到警告立即處理
   - 避免問題累積

### 適合場景
- 🔨 開發新功能時頻繁檢查
- 🔧 重構代碼時確保質量
- 🎯 處理關鍵邏輯時謹慎驗證
- 👥 結對編程時的質量保證

### 不適合場景
- 📖 純粹閱讀代碼
- 📝 編寫純文檔
- 🧪 運行自動化測試
- 🔍 專注調試特定問題

## 🤝 與 /check 的配合

```bash
# 完整的質量保證流程
/watch on           # 開始編碼前開啟監察
[編碼過程中持續提交和獲得反饋...]
/check             # 完成後執行完整檢查
/watch off         # 結束工作關閉監察
```

區別：
- `/watch`：過程中的持續關注，快速反饋
- `/check`：階段性的完整審查，詳細報告

## ⚙️ 配置選項

監察模式使用項目的 `.claude/watch.config.yml`：
```yaml
watch:
  auto_remind: true      # 是否自動提醒提交代碼
  remind_interval: 10    # 提醒間隔（分鐘）
  
  sensitivity:
    security: high       # high | medium | low
    quality: medium
    performance: medium
    practices: low
  
  ignore_patterns:       # 忽略的文件模式
    - "*.test.js"
    - "*.spec.ts"
    - "*.min.js"
  
  focus_areas:          # 重點關注區域
    - authentication
    - payment
    - database
```

## 🔔 期望管理

**請記住**：
- ✅ 這是一個輔助工具，幫助您保持代碼質量意識
- ✅ 通過主動提交獲得即時反饋
- ✅ 建立良好的編碼和檢查習慣
- ❌ 不是自動化的背景監控服務
- ❌ 不能替代 CI/CD 中的自動化檢查
- ❌ 需要您的主動參與才能發揮作用

監察模式幫助您在編碼過程中保持質量意識，但需要您的積極配合！