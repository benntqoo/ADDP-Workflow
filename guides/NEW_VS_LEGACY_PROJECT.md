# 新项目 vs 遗留项目：Claude Code 使用指南对比

## 🎯 快速决策树

```mermaid
graph TD
    A[开始使用 Claude Code] --> B{项目类型?}
    B -->|全新项目| C[使用标准元工作流]
    B -->|现有项目| D{代码规模?}
    D -->|小型 <1万行| E[快速接入模式]
    D -->|中大型 >1万行| F[渐进接入模式]
    C --> G[/meta 命令]
    E --> H[/onboard 命令]
    F --> I[/audit + /onboard]
```

## 📊 关键差异对比

| 维度 | 新项目 | 遗留项目 |
|------|--------|----------|
| **首要任务** | 建立规范 | 理解现状 |
| **启动命令** | `/meta` | `/onboard` |
| **工作重点** | 定义最佳实践 | 识别现有模式 |
| **改动策略** | 大胆创新 | 谨慎保守 |
| **规范制定** | 从零开始 | 基于现有 |
| **风险等级** | 低 | 高 |
| **时间投入** | 快速启动 | 渐进融入 |

## 🚀 新项目工作流

### Day 1：快速启动
```bash
# 1. 初始化项目
git init my-project
cd my-project

# 2. 启动元工作流
/meta

# 3. Claude 会问：
- 项目类型？
- 技术栈？
- 团队规模？
- 性能要求？

# 4. 生成定制的 CLAUDE.md
```

### 示例对话
```yaml
用户: /meta
Claude: 让我们为您的新项目定制规范！请告诉我项目类型...
用户: 这是一个 Next.js 14 的电商网站
Claude: [生成完整的项目规范，包括最佳实践]
```

### 优势
- ✅ 从一开始就有清晰的规范
- ✅ 避免技术债务积累
- ✅ 团队协作更顺畅
- ✅ Claude 可以更主动地提供建议

## 🏗️ 遗留项目工作流

### Week 1：理解阶段
```bash
# 1. 进入现有项目
cd existing-project

# 2. 项目审计
/audit

# 3. 正式接入
/onboard

# 4. Claude 会：
- 扫描代码结构
- 分析现有规范
- 识别技术债务
- 生成健康报告
```

### 示例对话
```yaml
用户: /onboard
Claude: 正在扫描您的项目... 发现这是一个3年历史的 Express 项目
      代码风格：混合（ES5/ES6）
      测试覆盖：45%
      让我了解一些背景信息...
用户: 团队5人，主要问题是代码不一致
Claude: [生成渐进式改进计划]
```

### 挑战与应对
- ⚠️ **挑战**: 代码风格不一致
  - **应对**: 先规范新代码，逐步统一旧代码

- ⚠️ **挑战**: 缺少文档
  - **应对**: Claude 通过代码分析推断业务逻辑

- ⚠️ **挑战**: 技术债务多
  - **应对**: 优先处理高风险区域

## 💡 选择建议

### 适合用新项目模式的情况
- 真正的全新项目
- 完全重写的项目
- POC 或原型项目
- 小型独立模块

### 必须用遗留项目模式的情况
- 生产环境运行的系统
- 有历史包袱的代码库
- 多人维护的项目
- 客户定制项目

### 混合模式
某些情况下可以混合使用：
- 在遗留项目中创建新模块时，该模块可用新项目模式
- 逐步迁移时，新服务用新模式，旧服务用遗留模式

## 📝 CLAUDE.md 差异

### 新项目版本
```yaml
# 重点是理想化的最佳实践
架构约定:
  MUST: 所有组件使用 TypeScript
  MUST: 100% 测试覆盖率
  PREFER: 函数式编程风格
```

### 遗留项目版本
```yaml
# 重点是现实和兼容性
架构约定:
  MUST: 新代码使用 TypeScript（旧代码逐步迁移）
  GOAL: 将测试覆盖率从 45% 提升到 70%
  ALLOW: 混合编程风格（过渡期）
  
特殊注意:
  - auth.js 使用回调模式（历史原因）
  - 不要修改 legacy/ 目录下的代码
  - API 必须保持向后兼容
```

## 🎯 成功指标

### 新项目
- 代码一致性 100%
- 零技术债务
- 高开发效率
- 易于维护

### 遗留项目
- bug 率降低 30%
- 新代码符合规范
- 团队满意度提升
- 平滑过渡无事故

## 🔧 工具使用差异

### 新项目常用命令
```bash
/meta      # 定制规范
/setup     # 初始化环境
/create    # 生成代码
/test      # 创建测试
```

### 遗留项目常用命令
```bash
/onboard   # 项目接入
/audit     # 健康检查
/discover  # 理解功能
/retrofit  # 渐进改造
```

## 📚 进阶技巧

### 新项目
1. 尽早定义所有规范
2. 使用最新的技术栈
3. 建立 CI/CD 流程
4. 强制代码审查

### 遗留项目
1. 建立测试基线
2. 创建重构路线图
3. 设置质量门禁
4. 小步快跑

---

*记住：选择正确的模式是成功的第一步。新项目追求理想，遗留项目注重现实。*